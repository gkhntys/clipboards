[{"id":"3ffa7fe4.1ea2b","type":"inject","z":"857cfe6d.aeece","name":"1 Minute","topic":"","payload":"","payloadType":"date","repeat":"59","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":120,"wires":[["bf754491.bea158"]]},{"id":"98d6c5ec.531e98","type":"function","z":"857cfe6d.aeece","name":"Changing Payload Format","func":"let exclude = [\"T1\",\"T2\",\"T3\",\"T4\",\"T5\",\"T6\",\"P1\",\"P2\",\"R1\",\"R2\",\"R4\",\"Hz\", \"P3\", \"P4\"];\nlet data = global.get( \"azure_data\" );\n\nlet res =   {\n  \"deviceId\": \"RPG-EN-1\",\n  \"key\": \"Lu/+0K3o+Zrp4QXIf4zVk6bDnkGYpPf7n282P0YI6BY=\",\n  \"protocol\": \"amqp\",\n  \"data\": {\n    \"Version\": \"1.0\",\n    \"SourceType\": \"INTEGRATED\",\n    \"Source\": \"REPG\",\n    \"UniqueId\": \"\",\n    \"Data\": {\n      \"Messages\": []\n    }\n  }\n}\n\n\nfor( let i of Object.entries( data ) ) {\n    \n    if( !exclude.includes(  i[0] )   &&  i[1] !== undefined ) {    \n   \n\n\n\n      res.data.Data.Messages.push(   {\n                          \"Timestamp\": new Date(),\n                          \"Parameters\": [\n                                {\n                                  \"Key\": i[0],\n                                  \"Value\": String( i[1] )\n                                }\n                                        ]\n                                  }\n                        \n                            )\n  \n    \n    } // end of if  \n   \n    \n} // end of loop\n\n\n\n\nmsg.payload = res;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":320,"wires":[["3d2bfa10.70f326","a004b60e.b0ba78"]]},{"id":"a004b60e.b0ba78","type":"azureiothub","z":"857cfe6d.aeece","name":"Azure IoT Hub","protocol":"amqp","x":560,"y":220,"wires":[["f01d26f1.6f9a58"]]},{"id":"28b60f6f.685c9","type":"debug","z":"857cfe6d.aeece","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":120,"wires":[]},{"id":"f01d26f1.6f9a58","type":"debug","z":"857cfe6d.aeece","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":220,"wires":[]},{"id":"cae1ce24.ca35d","type":"inject","z":"857cfe6d.aeece","name":"1 Minute","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":320,"wires":[["98d6c5ec.531e98"]]},{"id":"3d2bfa10.70f326","type":"debug","z":"857cfe6d.aeece","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":320,"wires":[]},{"id":"bf754491.bea158","type":"function","z":"857cfe6d.aeece","name":"Changing Payload Format","func":"let exclude = [\"V1\",\"V2\",\"V3\",\"C1\",\"C2\",\"C3\",\"WT\",\"WE\"]\n\nlet data = global.get( \"azure_data\" );\n\nlet res =   {\n  \"deviceId\": \"RPG-EN-1\",\n  \"key\": \"Lu/+0K3o+Zrp4QXIf4zVk6bDnkGYpPf7n282P0YI6BY=\",\n  \"protocol\": \"amqp\",\n  \"data\": {\n    \"Version\": \"1.0\",\n    \"SourceType\": \"INTEGRATED\",\n    \"Source\": \"REPG\",\n    \"UniqueId\": \"\",\n    \"Data\": {\n      \"Messages\": []\n    }\n  }\n}\n\n\nfor( let i of Object.entries( data ) ) {\n    \n    if( !exclude.includes(  i[0] )   &&  i[1] !== undefined ) {    \n   \n\n\n\n      res.data.Data.Messages.push(   {\n                          \"Timestamp\": new Date(),\n                          \"Parameters\": [\n                                {\n                                  \"Key\": i[0],\n                                  \"Value\": String( i[1] )\n                                }\n                                        ]\n                                  }\n                        \n                            )\n  \n    \n    } // end of if  \n   \n    \n} // end of loop\n\n\n\n\nmsg.payload = res;\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":100,"wires":[["28b60f6f.685c9","a004b60e.b0ba78"]]},{"id":"569e5082.0b2cf","type":"comment","z":"857cfe6d.aeece","name":"RePG Anadolu Hotels1","info":"","x":740,"y":60,"wires":[]}]