[{"id":"69a517e3.971bc8","type":"function","z":"ea346b60.b4dd18","name":"Changing Payload Format","func":"let exclude = [\"V1\",\"V2\",\"V3\",\"C1\",\"C2\",\"C3\",\"WT\",\"WE\"]\n\nlet data = global.get( \"azure_data\" );\n\nlet res =   {\n  \"deviceId\": \"RPG-SN-Pilot-3\",\n  \"key\": \"z0XTqYbkkzKOZuX/C5VHYxpfyuuJJfjfDETTdJa+XFk=\",\n  \"protocol\": \"amqp\",\n  \"data\": {\n    \"Version\": \"1.0\",\n    \"SourceType\": \"INTEGRATED\",\n    \"Source\": \"REPG\",\n    \"UniqueId\": \"\",\n    \"Data\": {\n      \"Messages\": []\n    }\n  }\n}\n\n\nfor( let i of Object.entries( data ) ) {\n    \n    if( !exclude.includes(  i[0] )   &&  i[1] !== undefined ) {    \n   \n\n\n\n      res.data.Data.Messages.push(   {\n                          \"Timestamp\": new Date(),\n                          \"Parameters\": [\n                                {\n                                  \"Key\": i[0],\n                                  \"Value\": String( i[1] )\n                                }\n                                        ]\n                                  }\n                        \n                            )\n  \n    \n    } // end of if  \n   \n    \n} // end of loop\n\n\n\n\nmsg.payload = res;\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":220,"wires":[["4dce60b0.aa397","f7e7191.5342ce8"]]},{"id":"9f746105.c5de1","type":"comment","z":"ea346b60.b4dd18","name":"PLC","info":"","x":150,"y":60,"wires":[]},{"id":"154c1fc9.eb2f1","type":"inject","z":"ea346b60.b4dd18","name":"1 Minute","topic":"","payload":"","payloadType":"date","repeat":"59","crontab":"","once":false,"onceDelay":0.1,"x":280,"y":220,"wires":[["69a517e3.971bc8"]]},{"id":"f7e7191.5342ce8","type":"azureiothub","z":"ea346b60.b4dd18","name":"Azure IoT Hub","protocol":"amqp","x":700,"y":320,"wires":[["48c30215.9da1bc"]]},{"id":"4dce60b0.aa397","type":"debug","z":"ea346b60.b4dd18","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":220,"wires":[]},{"id":"48c30215.9da1bc","type":"debug","z":"ea346b60.b4dd18","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":320,"wires":[]},{"id":"66b3a07.c64916","type":"inject","z":"ea346b60.b4dd18","name":"1 Hour","topic":"","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":false,"onceDelay":0.1,"x":280,"y":420,"wires":[["b692da83.3cdb78"]]},{"id":"9e4e01a2.2defc","type":"debug","z":"ea346b60.b4dd18","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":420,"wires":[]},{"id":"b692da83.3cdb78","type":"function","z":"ea346b60.b4dd18","name":"Changing Payload Format","func":"let exclude = [\"T1\",\"T2\",\"T3\",\"T4\",\"T5\",\"T6\",\"P1\",\"P2\",\"R1\",\"R2\",\"R4\",\"Hz\", \"P3\", \"P4\"];\nlet data = global.get( \"azure_data\" );\n\nlet res =   {\n  \"deviceId\": \"RPG-SN-Pilot-3\",\n  \"key\": \"z0XTqYbkkzKOZuX/C5VHYxpfyuuJJfjfDETTdJa+XFk=\",\n  \"protocol\": \"amqp\",\n  \"data\": {\n    \"Version\": \"1.0\",\n    \"SourceType\": \"INTEGRATED\",\n    \"Source\": \"REPG\",\n    \"UniqueId\": \"\",\n    \"Data\": {\n      \"Messages\": []\n    }\n  }\n}\n\n\nfor( let i of Object.entries( data ) ) {\n    \n    if( !exclude.includes(  i[0] )   &&  i[1] !== undefined ) {    \n   \n\n\n\n      res.data.Data.Messages.push(   {\n                          \"Timestamp\": new Date(),\n                          \"Parameters\": [\n                                {\n                                  \"Key\": i[0],\n                                  \"Value\": String( i[1] )\n                                }\n                                        ]\n                                  }\n                        \n                            )\n  \n    \n    } // end of if  \n   \n    \n} // end of loop\n\n\n\n\nmsg.payload = res;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":420,"wires":[["f7e7191.5342ce8","9e4e01a2.2defc"]]},{"id":"71b8960f.bc2ab8","type":"comment","z":"ea346b60.b4dd18","name":"26.12.2019","info":"","x":1100,"y":100,"wires":[]}]